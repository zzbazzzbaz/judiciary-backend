{% extends "admin/base_site.html" %}
{% load i18n static %}

{% block title %}æ‰€æœ‰ä»»åŠ¡{% endblock %}

{% block extrahead %}
{{ block.super }}
<style>
    .task-container {
        padding: 20px;
    }
    .page-header {
        display: flex;
        justify-content: space-between;
        align-items: center;
        margin-bottom: 20px;
    }
    .page-title {
        font-size: 20px;
        font-weight: 600;
        color: #333;
    }
    .task-stats {
        display: flex;
        gap: 15px;
    }
    .stat-item {
        padding: 4px 12px;
        border-radius: 20px;
        font-size: 14px;
    }
    .stat-total { background: #e9ecef; color: #495057; }
    .stat-pending { background: #fff3cd; color: #856404; }
    .stat-processing { background: #cce5ff; color: #004085; }
    .stat-completed { background: #d4edda; color: #155724; }
    .task-table {
        width: 100%;
        border-collapse: collapse;
        background: #fff;
        box-shadow: 0 1px 3px rgba(0,0,0,0.1);
    }
    .task-table th,
    .task-table td {
        padding: 12px 15px;
        text-align: left;
        border-bottom: 1px solid #e0e0e0;
    }
    .task-table th {
        background: #f5f5f5;
        font-weight: 600;
        color: #333;
    }
    .task-table tr:hover {
        background: #f9f9f9;
    }
    .task-code {
        font-family: monospace;
        color: #417690;
    }
    .task-type {
        display: inline-block;
        padding: 2px 8px;
        border-radius: 4px;
        font-size: 12px;
    }
    .type-dispute { background: #fff3cd; color: #856404; }
    .type-legal_aid { background: #d4edda; color: #155724; }
    .status-badge {
        display: inline-block;
        padding: 3px 10px;
        border-radius: 4px;
        font-size: 12px;
    }
    .status-reported { background: #f8d7da; color: #721c24; }
    .status-assigned { background: #fff3cd; color: #856404; }
    .status-processing { background: #cce5ff; color: #004085; }
    .status-completed { background: #d4edda; color: #155724; }
    .task-time {
        color: #666;
        font-size: 13px;
    }
    .empty-state {
        text-align: center;
        padding: 60px 20px;
        color: #666;
    }
    .filter-bar {
        background: #fff;
        padding: 15px;
        margin-bottom: 20px;
        border-radius: 4px;
        box-shadow: 0 1px 3px rgba(0,0,0,0.1);
        display: flex;
        gap: 15px;
        align-items: center;
    }
    .filter-bar select {
        padding: 8px 12px;
        border: 1px solid #ddd;
        border-radius: 4px;
    }
    .filter-bar button {
        padding: 8px 20px;
        background: #417690;
        color: #fff;
        border: none;
        border-radius: 4px;
        cursor: pointer;
    }
    .btn-view {
        padding: 4px 12px;
        background: #6c757d;
        color: #fff;
        border: none;
        border-radius: 4px;
        text-decoration: none;
        font-size: 12px;
    }
    .btn-view:hover {
        background: #5a6268;
        color: #fff;
    }
</style>
{% endblock %}

{% block content %}
<div class="task-container">
    <div class="page-header">
        <h2 class="page-title">ğŸ“‹ æ‰€æœ‰ä»»åŠ¡</h2>
        <div class="task-stats">
            <span class="stat-item stat-total">å…± {{ stats.total }} æ¡</span>
            <span class="stat-item stat-pending">å¾…åˆ†é… {{ stats.reported }}</span>
            <span class="stat-item stat-processing">å¤„ç†ä¸­ {{ stats.processing }}</span>
            <span class="stat-item stat-completed">å·²å®Œæˆ {{ stats.completed }}</span>
        </div>
    </div>

    <form method="get" class="filter-bar">
        <label>çŠ¶æ€ï¼š</label>
        <select name="status">
            <option value="">å…¨éƒ¨</option>
            <option value="reported" {% if current_status == 'reported' %}selected{% endif %}>å·²ä¸ŠæŠ¥</option>
            <option value="assigned" {% if current_status == 'assigned' %}selected{% endif %}>å·²åˆ†é…</option>
            <option value="processing" {% if current_status == 'processing' %}selected{% endif %}>è¿›è¡Œä¸­</option>
            <option value="completed" {% if current_status == 'completed' %}selected{% endif %}>å·²å®Œæˆ</option>
        </select>
        <label>ç±»å‹ï¼š</label>
        <select name="type">
            <option value="">å…¨éƒ¨</option>
            <option value="dispute" {% if current_type == 'dispute' %}selected{% endif %}>çº çº·è°ƒè§£</option>
            <option value="legal_aid" {% if current_type == 'legal_aid' %}selected{% endif %}>æ³•å¾‹æ´åŠ©</option>
        </select>
        <button type="submit">ç­›é€‰</button>
    </form>

    {% if tasks %}
    <table class="task-table">
        <thead>
            <tr>
                <th>ä»»åŠ¡ç¼–å·</th>
                <th>ç±»å‹</th>
                <th>å½“äº‹äºº</th>
                <th>çŠ¶æ€</th>
                <th>è°ƒè§£å‘˜</th>
                <th>ä¸ŠæŠ¥æ—¶é—´</th>
                <th>æ“ä½œ</th>
            </tr>
        </thead>
        <tbody>
            {% for task in tasks %}
            <tr>
                <td><span class="task-code">{{ task.code }}</span></td>
                <td>
                    <span class="task-type type-{{ task.type }}">
                        {{ task.get_type_display }}
                    </span>
                </td>
                <td>{{ task.party_name|truncatechars:20 }}</td>
                <td>
                    <span class="status-badge status-{{ task.status }}">
                        {{ task.get_status_display }}
                    </span>
                </td>
                <td>{{ task.assigned_mediator.name|default:"-" }}</td>
                <td class="task-time">{{ task.reported_at|date:"Y-m-d H:i" }}</td>
                <td>
                    <a href="../{{ task.id }}/change/" class="btn-view">æŸ¥çœ‹</a>
                </td>
            </tr>
            {% endfor %}
        </tbody>
    </table>
    {% else %}
    <div class="empty-state">
        <p>æš‚æ— ä»»åŠ¡è®°å½•</p>
    </div>
    {% endif %}
</div>
{% endblock %}
