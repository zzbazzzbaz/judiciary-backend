{% extends "admin/base_site.html" %}
{% load i18n static %}

{% block title %}æœªåˆ†é…ä»»åŠ¡{% endblock %}

{% block extrahead %}
{{ block.super }}
<style>
    .task-container {
        padding: 20px;
    }
    .page-header {
        display: flex;
        justify-content: space-between;
        align-items: center;
        margin-bottom: 20px;
    }
    .page-title {
        font-size: 20px;
        font-weight: 600;
        color: #333;
    }
    .task-count {
        background: #dc3545;
        color: #fff;
        padding: 4px 12px;
        border-radius: 20px;
        font-size: 14px;
    }
    .task-table {
        width: 100%;
        border-collapse: collapse;
        background: #fff;
        box-shadow: 0 1px 3px rgba(0,0,0,0.1);
    }
    .task-table th,
    .task-table td {
        padding: 12px 15px;
        text-align: left;
        border-bottom: 1px solid #e0e0e0;
    }
    .task-table th {
        background: #f5f5f5;
        font-weight: 600;
        color: #333;
    }
    .task-table tr:hover {
        background: #f9f9f9;
    }
    .task-code {
        font-family: monospace;
        color: #417690;
    }
    .task-type {
        display: inline-block;
        padding: 2px 8px;
        border-radius: 4px;
        font-size: 12px;
    }
    .type-dispute {
        background: #fff3cd;
        color: #856404;
    }
    .type-legal_aid {
        background: #d4edda;
        color: #155724;
    }
    .mediator-select {
        padding: 6px 10px;
        border: 1px solid #ddd;
        border-radius: 4px;
        min-width: 150px;
    }
    .btn-assign {
        padding: 6px 16px;
        background: #28a745;
        color: #fff;
        border: none;
        border-radius: 4px;
        cursor: pointer;
        font-size: 13px;
    }
    .btn-assign:hover {
        background: #218838;
    }
    .btn-assign:disabled {
        background: #ccc;
        cursor: not-allowed;
    }
    .success-msg {
        background: #d4edda;
        color: #155724;
        padding: 12px 15px;
        border-radius: 4px;
        margin-bottom: 15px;
    }
    .error-msg {
        background: #f8d7da;
        color: #721c24;
        padding: 12px 15px;
        border-radius: 4px;
        margin-bottom: 15px;
    }
    .empty-state {
        text-align: center;
        padding: 60px 20px;
        color: #666;
    }
    .empty-state .icon {
        font-size: 48px;
        margin-bottom: 15px;
    }
    .task-time {
        color: #666;
        font-size: 13px;
    }
</style>
{% endblock %}

{% block content %}
<div class="task-container">
    <div class="page-header">
        <h2 class="page-title">ğŸ“‹ æœªåˆ†é…ä»»åŠ¡</h2>
        <span class="task-count">{{ tasks|length }} æ¡å¾…åˆ†é…</span>
    </div>

    {% if messages %}
        {% for message in messages %}
            <div class="{% if message.tags == 'success' %}success-msg{% else %}error-msg{% endif %}">
                {{ message }}
            </div>
        {% endfor %}
    {% endif %}

    {% if tasks %}
    <table class="task-table">
        <thead>
            <tr>
                <th>ä»»åŠ¡ç¼–å·</th>
                <th>ç±»å‹</th>
                <th>å½“äº‹äºº</th>
                <th>ä¸ŠæŠ¥äºº</th>
                <th>ä¸ŠæŠ¥æ—¶é—´</th>
                <th>åˆ†é…ç»™</th>
                <th>æ“ä½œ</th>
            </tr>
        </thead>
        <tbody>
            {% for task in tasks %}
            <tr>
                <td><span class="task-code">{{ task.code }}</span></td>
                <td>
                    <span class="task-type type-{{ task.type }}">
                        {{ task.get_type_display }}
                    </span>
                </td>
                <td>{{ task.party_name|truncatechars:20 }}</td>
                <td>{{ task.reporter.name|default:"-" }}</td>
                <td class="task-time">{{ task.reported_at|date:"m-d H:i" }}</td>
                <td>
                    <form method="post" style="display: inline-flex; gap: 8px;">
                        {% csrf_token %}
                        <input type="hidden" name="task_id" value="{{ task.id }}">
                        <select name="mediator_id" class="mediator-select" required>
                            <option value="">-- é€‰æ‹©è°ƒè§£å‘˜ --</option>
                            {% for m in mediators %}
                            <option value="{{ m.id }}">{{ m.name }}</option>
                            {% endfor %}
                        </select>
                </td>
                <td>
                        <button type="submit" class="btn-assign">åˆ†é…</button>
                    </form>
                </td>
            </tr>
            {% endfor %}
        </tbody>
    </table>
    {% else %}
    <div class="empty-state">
        <div class="icon">âœ…</div>
        <p>æš‚æ— å¾…åˆ†é…ä»»åŠ¡</p>
    </div>
    {% endif %}
</div>
{% endblock %}
